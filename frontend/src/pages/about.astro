---
import Layout from "../layouts/Layout.astro";
import Prose from "../components/Prose.astro";
import { marked } from "marked";
import { fetchSingleType, fetchSiteSettings } from "../lib/api";
import { getMediaUrl, transformContentUrls } from "../lib/imageUrl";

const [about, siteSettings] = await Promise.all([
    fetchSingleType("about"),
    fetchSiteSettings(),
]);

// Use CKEditor richContent if available, fallback to markdown content
const useRichContent = !!about.richContent;
const rawHtml = useRichContent ? about.richContent : await marked(about.content);
// Transform relative /uploads/ URLs to absolute Strapi URLs
const htmlContent = transformContentUrls(rawHtml);

const image = about.images[0];
const imageUrl = getMediaUrl(image.url);

// SEO data
const siteName = siteSettings?.siteName || "Hill People";
const description = `Learn more about ${siteName}`;
---

<Layout
    pageTitle={about.title}
    description={description}
    ogImage={imageUrl}
    siteName={siteName}
>
    <div class="max-w-3xl mx-auto px-4 py-10">
        <div class="aspect-square overflow-hidden mb-8 rounded-xl">
            <img
                src={imageUrl}
                alt={about.title}
                class="w-full h-full object-cover"
            />
        </div>
        <h1 class="text-4xl font-bold mb-4">{about.title}</h1>
        <Prose set:html={htmlContent} />
    </div>
</Layout>
