---
import { marked } from "marked";
import Layout from "../../layouts/Layout.astro";
import { fetchPostBySlug } from "../../lib/api";
import { getMediaUrl, getLargestImage } from "../../lib/imageUrl";
import StravaEmbed from "../../components/StravaEmbed.astro";

const { slug } = Astro.params;

const post = await fetchPostBySlug(slug!);
const htmlContent = await marked(post.content);
const image = getLargestImage(post);
const imageUrl = getMediaUrl(image?.url);
---

<Layout>
    <article
        class="max-w-3xl mx-auto px-4 py-10 prose prose-lg dark:prose-invert"
    >
        {
            imageUrl && (
                <div class="aspect-square overflow-hidden mb-8">
                    <img
                        src={imageUrl}
                        alt={post.title}
                        class="w-full h-full object-cover"
                    />
                </div>
            )
        }

        <h1 class="text-4xl font-bold mb-4">{post.title}</h1>

        <div set:html={htmlContent} />

        {
            post.stravaActivityId && (
                <div class="mt-10">
                    <StravaEmbed activityId={post.stravaActivityId} />
                </div>
            )
        }
    </article>
</Layout>
