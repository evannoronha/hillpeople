---
import "../styles/global.css";
import Favicons from "../components/Favicons.astro";
import Header from "../components/Header.astro";
import NewsletterSignup from "../components/NewsletterSignup.astro";
import Footer from "../components/Footer.astro";
import SEO from "../components/SEO.astro";
import { fetchSingleType, fetchSiteSettings } from "../lib/api";

interface Props {
	pageTitle: string;
	description?: string;
	ogImage?: string;
	ogType?: 'website' | 'article';
	publishedTime?: string;
	authorName?: string;
	noindex?: boolean;
	siteName?: string;
	preloadImage?: string;
}

const {
	pageTitle,
	description = '',
	ogImage,
	ogType = 'website',
	publishedTime,
	authorName,
	noindex = false,
	siteName,
	preloadImage,
} = Astro.props;

// Fetch home page content for newsletter FAB (shown on all pages)
const homePage = await fetchSingleType("home-page", Astro.locals);
const siteSettings = await fetchSiteSettings(Astro.locals);
---

<!doctype html>
<html lang="en">
	<head>
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width" />
		<!-- Critical CSS inlined to avoid render blocking -->
		<style>
			:root {
				--color-bg: #f4f2ec;
				--color-text: #643f41;
				--color-header: #f16e53;
				--color-sub-header: #f16e53;
			}
			@media (prefers-color-scheme: dark) {
				:root {
					--color-bg: #101828;
					--color-text: #e7e7e7;
					--color-header: #d77a40;
					--color-sub-header: #dfcec3;
				}
			}
			html { font-family: "Libre Baskerville", Georgia, serif; }
			body { background-color: var(--color-bg); color: var(--color-text); }
		</style>
		<SEO
			title={pageTitle}
			description={description}
			ogImage={ogImage}
			ogType={ogType}
			publishedTime={publishedTime}
			authorName={authorName}
			noindex={noindex}
			siteName={siteName}
		/>
		<Favicons />
		<link rel="preconnect" href="https://fonts.googleapis.com" />
		<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
		<!-- Load Google Fonts asynchronously to avoid render blocking -->
		<link
			rel="preload"
			as="style"
			href="https://fonts.googleapis.com/css2?family=Libre+Baskerville:ital,wght@0,400;0,700;1,400&display=swap"
		/>
		<link
			href="https://fonts.googleapis.com/css2?family=Libre+Baskerville:ital,wght@0,400;0,700;1,400&display=swap"
			rel="stylesheet"
			media="print"
			onload="this.media='all'"
		/>
		<noscript>
			<link
				href="https://fonts.googleapis.com/css2?family=Libre+Baskerville:ital,wght@0,400;0,700;1,400&display=swap"
				rel="stylesheet"
			/>
		</noscript>
		<meta name="generator" content={Astro.generator} />
		{preloadImage && (
			<link rel="preload" as="image" href={preloadImage} fetchpriority="high" />
		)}
	</head>
	<body>
		<a
			href="#main-content"
			class="sr-only focus:not-sr-only focus:absolute focus:top-4 focus:left-4 focus:z-50 focus:bg-[var(--color-fab-bg)] focus:text-[var(--color-fab-text)] focus:px-4 focus:py-2 focus:rounded focus:outline-none"
		>
			Skip to main content
		</a>
		<Header />
		<main id="main-content">
			<slot />
		</main>
		<Footer
			tagline={siteSettings?.footerTagline}
			copyrightText={siteSettings?.copyrightText}
		/>
		<NewsletterSignup
			title={homePage?.newsletterTitle || "Subscribe to Hill People"}
			description={homePage?.newsletterDescription}
			buttonText={homePage?.newsletterButtonText}
			fabLabel={homePage?.newsletterFabLabel}
		/>
	</body>
</html>
