---
interface Props {
  title: string;
  description: string;
  canonicalUrl?: string;
  ogImage?: string;
  ogType?: 'website' | 'article';
  publishedTime?: string;
  authorName?: string;
  noindex?: boolean;
  siteName?: string;
}

const {
  title,
  description,
  canonicalUrl,
  ogImage,
  ogType = 'website',
  publishedTime,
  authorName,
  noindex = false,
  siteName = 'Hill People',
} = Astro.props;

const fullTitle = title === 'Home' ? siteName : `${title} - ${siteName}`;
const url = canonicalUrl || Astro.url.href;
const siteUrl = Astro.site?.href || 'https://hillpeople.net';

// Build JSON-LD structured data
const buildJsonLd = () => {
  const baseSchema = {
    "@context": "https://schema.org",
  };

  if (ogType === 'article') {
    // Article schema for blog posts
    const articleSchema: Record<string, unknown> = {
      ...baseSchema,
      "@type": "Article",
      "headline": title,
      "description": description,
      "url": url,
      "mainEntityOfPage": {
        "@type": "WebPage",
        "@id": url,
      },
    };

    if (ogImage) {
      articleSchema.image = ogImage;
    }

    if (publishedTime) {
      articleSchema.datePublished = publishedTime;
    }

    if (authorName) {
      articleSchema.author = {
        "@type": "Person",
        "name": authorName,
      };
    }

    return articleSchema;
  }

  // WebSite schema for homepage
  if (title === 'Home') {
    return {
      ...baseSchema,
      "@type": "WebSite",
      "name": siteName,
      "url": siteUrl,
      "description": description,
    };
  }

  // WebPage schema for other pages
  return {
    ...baseSchema,
    "@type": "WebPage",
    "name": fullTitle,
    "url": url,
    "description": description,
  };
};

// Build breadcrumb schema
const buildBreadcrumbSchema = () => {
  const pathSegments = new URL(url).pathname.split('/').filter(Boolean);

  if (pathSegments.length === 0) {
    return null; // No breadcrumbs for homepage
  }

  const items = [
    {
      "@type": "ListItem",
      "position": 1,
      "name": "Home",
      "item": siteUrl,
    },
  ];

  let currentPath = siteUrl;
  pathSegments.forEach((segment, index) => {
    currentPath = `${currentPath.replace(/\/$/, '')}/${segment}`;
    items.push({
      "@type": "ListItem",
      "position": index + 2,
      "name": index === pathSegments.length - 1 ? title : segment.charAt(0).toUpperCase() + segment.slice(1),
      "item": currentPath,
    });
  });

  return {
    "@context": "https://schema.org",
    "@type": "BreadcrumbList",
    "itemListElement": items,
  };
};

const jsonLd = buildJsonLd();
const breadcrumbSchema = buildBreadcrumbSchema();
---

<!-- Primary Meta Tags -->
<title>{fullTitle}</title>
<meta name="description" content={description} />
{noindex && <meta name="robots" content="noindex, nofollow" />}
<link rel="canonical" href={url} />

<!-- Open Graph -->
<meta property="og:type" content={ogType} />
<meta property="og:url" content={url} />
<meta property="og:title" content={fullTitle} />
<meta property="og:description" content={description} />
<meta property="og:site_name" content={siteName} />
{ogImage && <meta property="og:image" content={ogImage} />}
{publishedTime && <meta property="article:published_time" content={publishedTime} />}
{authorName && <meta property="article:author" content={authorName} />}

<!-- JSON-LD Structured Data -->
<script type="application/ld+json" set:html={JSON.stringify(jsonLd)} />
{breadcrumbSchema && (
  <script type="application/ld+json" set:html={JSON.stringify(breadcrumbSchema)} />
)}
